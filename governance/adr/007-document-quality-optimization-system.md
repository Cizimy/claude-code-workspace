# ADR-007: ドキュメント品質最適化システムの導入決定

## Status
Proposed

## Date
2025-07-14

## Context

### 現状のドキュメント品質課題

Claude Code Workspace において、AI完璧主義防止システム（ADR-003）とドキュメント複雑性制御システム（ADR-005）導入後、以下のドキュメント品質に関する改善要求が顕在化している：

#### CLAUDE.md の肥大化・重複問題
1. **内容重複**: AI完璧主義対策が複数セクションに散在
   - 現在約200行→目標150行以下への削減必要
   - 詳細説明とクイックリファレンスの分離不足
   - Claude の読み込み効率・記憶効率の低下

2. **階層構造の不明確化**: 
   - 基本原則 vs 詳細ガイダンスの混在
   - 緊急時参照情報 vs 学習用情報の未分離
   - 新規開発者向け vs 既存開発者向けの情報混在

#### 教育的ブロックメッセージの品質問題
3. **Claude 解釈困難**: 
   - 長文エラーメッセージによる再試行失敗
   - 構造化されていない出力による情報取得困難
   - 具体例・再試行手順の一貫性不足

4. **再利用性・保守性不足**:
   - Hook間でのメッセージフォーマット不統一
   - メッセージ改善時の多重修正必要
   - A/Bテスト・効果測定の困難

### 改善要求（ai_perfectionism_prevention_plan.md 戦略C,D）
- **C. CLAUDE.md最小核化**: 重複記述除去・詳細分離による可読性向上
- **D. 教育的ブロック最適化**: Markdown箇条書き統一・再試行率向上

### 既存システムとの統合必要性
- **ADR-006統合品質ガード**: quality-gate.sh での統一メッセージ出力
- **ADR-005ドキュメント複雑性制御**: Front-Matter標準化との整合性
- **ADR-003 AI完璧主義防止**: 憲法強化と詳細ガイダンス分離

## Decision

ドキュメント品質最適化システムを導入し、以下2つの統合決定を実装する：

### 戦略C: CLAUDE.md最小核化アーキテクチャ
**実装**: 階層分離・コンテンツ最適化
```
CLAUDE.md (≤150行)
├── AI完璧主義対策 (禁止事項・自己チェック質問のみ)
├── 開発原則 (TDD・YAGNI・KISS)
└── 基本コマンド・Hook設定

詳細ガイダンス分離
├── .claude/docs/anti_perfectionism.md (詳細WHY・具体例)
├── .claude/docs/tdd_detailed_guide.md (TDD実践詳細)
└── .claude/docs/hook_troubleshooting.md (Hook詳細トラブルシューティング)
```

**最小核化原則**:
- **記憶効率優先**: Claude が頻繁に参照する情報のみ残存
- **アクション重視**: 「何をすべきか」中心、「なぜそうするか」は分離
- **検索性確保**: 詳細情報への明確なリンク・パス提供

### 戦略D: 教育的ブロック統一アーキテクチャ
**実装**: 構造化メッセージ・テンプレートシステム
```bash
# 統一メッセージテンプレート
output_educational_block() {
    local violation_type="$1"
    local cause="$2"
    local solution="$3" 
    local example="$4"
    
    cat >&2 <<EOF
🚫 **${violation_type}**

**原因**: ${cause}

**対処**: ${solution}

**再試行**: ${example}
EOF
}
```

**統一原則**:
- **Markdown箇条書き**: Claude の構造化情報取得最適化
- **3段構成**: 原因→対処→再試行例の固定フォーマット
- **具体例必須**: 再試行コマンド・手順の具体的記載
- **簡潔性**: 1メッセージ100語以内、本質情報のみ

## Consequences

### 期待される正の影響

#### 1. Claude 体験の劇的改善
- **読み込み効率**: CLAUDE.md 25%削減による処理時間短縮
- **記憶効率**: 核心情報集約による長時間セッション品質維持
- **再試行成功率**: 構造化メッセージによる自己修正能力向上（目標80%→95%）

#### 2. 開発者体験の向上
- **学習曲線**: 段階的情報提示による新規開発者オンボーディング改善
- **参照効率**: 詳細情報への明確パス提供による調査時間短縮
- **エラー対応**: 一貫性のある教育的メッセージによる自己解決促進

#### 3. 保守・運用効率の向上
- **メッセージ統一**: テンプレート化による品質一貫性確保
- **更新効率**: 詳細分離による影響範囲限定化
- **効果測定**: 構造化データによるA/Bテスト・改善計画立案支援

### 潜在的な負の影響とリスク軽減策

#### 1. 情報分散による発見性低下
- **リスク**: 詳細情報へのアクセス困難・参照漏れ
- **軽減策**: 
  - CLAUDE.md 内での明確なリンク提供
  - `.claude/docs/` 配下の構造化・インデックス化
  - 検索支援（ADR-005 SQLite統合検索）

#### 2. 分離作業の複雑性
- **リスク**: 既存コンテンツの適切な分離判断・実装工数
- **軽減策**:
  - 段階的移行（核心内容先行、詳細後回し）
  - 既存コンテンツのバックアップ・復旧準備
  - 分離基準の明確化（後述Implementation Plan）

#### 3. 教育的メッセージの画一化
- **リスク**: 状況固有の細かい指導・フィードバック品質低下
- **軽減策**:
  - テンプレート内での動的コンテキスト情報付与
  - violation_type 別のカスタマイズ機能保持
  - 定期的なメッセージ効果測定・改善

## Implementation Plan

### Phase 1: CLAUDE.md最小核化（2-3日）

#### 1.1 現状分析・分離基準策定
1. **コンテンツ棚卸**: 既存CLAUDE.md の全セクション分類
   - **核心情報**: 日常開発で頻繁参照（TDD原則、基本コマンド、禁止事項）
   - **詳細ガイダンス**: 学習・トラブルシューティング時参照
   - **冗長情報**: 重複・過剰説明・削除対象

2. **分離先ファイル設計**:
   ```
   .claude/docs/
   ├── anti_perfectionism.md      # AI完璧主義対策の詳細WHY・背景・具体例
   ├── tdd_detailed_guide.md      # TDD実践詳細・応用パターン
   ├── hook_troubleshooting.md    # Hook詳細エラー対応・設定解説
   └── development_examples.md    # 実践例・ケーススタディ
   ```

#### 1.2 最小核CLAUDE.md 実装
1. **AI完璧主義対策セクション**: 禁止事項・自己チェック質問のみ残存
   ```markdown
   ## AI完璧主義対策
   ### 禁止
   - 95%→100%を狙うリファクタ
   - 5ファイル以上の同時新規作成
   - 2026年以降のロードマップ
   
   ### 自己チェック
   1. 今すぐ必要か？
   2. 実証された価値は？
   3. 最もシンプルか？
   ```

2. **詳細リンク統合**: 各セクションに詳細参照先明記
   ```markdown
   > 詳細・具体例: [AI完璧主義防止詳細ガイド](.claude/docs/anti_perfectionism.md)
   ```

#### 1.3 詳細ガイダンス分離
1. **anti_perfectionism.md**: AI完璧主義症候群の背景・心理・実例
2. **tdd_detailed_guide.md**: TDD実践の詳細手順・応用・トラブル事例
3. **hook_troubleshooting.md**: Hook システム詳細・権限・環境トラブル

### Phase 2: 教育的ブロック統一（1-2日）

#### 2.1 メッセージテンプレート標準化
1. **lib/message_templates.sh 作成**: 統一メッセージ関数ライブラリ
2. **違反タイプ別カスタマイズ**: TDD_VIOLATION, MASS_CREATION_VIOLATION, COVERAGE_VIOLATION
3. **動的情報統合**: プロジェクト名・ファイル名・設定値の埋め込み

#### 2.2 既存Hook統合
1. **quality-gate.sh 統合**: ADR-006 統合システムでのテンプレート適用
2. **メッセージ品質検証**: Claude 再試行成功率測定・改善
3. **一貫性確保**: 全Hook段階での統一フォーマット適用

### Phase 3: 効果測定・改善（1日）

#### 3.1 品質メトリクス設定
1. **CLAUDE.md メトリクス**: 行数、内部リンク数、更新頻度
2. **再試行メトリクス**: 教育的ブロック後の成功率、エラー再発率
3. **開発者体験**: 情報発見時間、エラー解決時間

#### 3.2 継続改善プロセス
1. **週次レビュー**: メトリクス確認・メッセージ改善
2. **月次最適化**: CLAUDE.md 核心情報の見直し・詳細分離調整
3. **四半期評価**: 全体アーキテクチャ有効性・次期改善検討

## Success Metrics

### 定量指標
- **CLAUDE.md 行数**: 200行 → 150行以下（25%削減）
- **Claude 再試行成功率**: 80% → 95%（教育的メッセージ改善効果）
- **情報発見時間**: 50%短縮（詳細分離・リンク最適化）
- **メッセージ保守効率**: 90%削減（テンプレート統一効果）

### 定性指標
- **Claude 体験**: 長時間セッションでの憲法記憶・品質維持
- **開発者体験**: 新規開発者オンボーディング時間短縮
- **エラー対応**: 自己解決率向上・質問エスカレーション削減
- **保守性**: ドキュメント更新・メッセージ改善の容易性

## Related Documents

### 基盤ADR
- [ADR-003: AI完璧主義防止システム](003-ai-perfectionism-prevention-system.md) - 基本方針・憲法強化
- [ADR-005: ドキュメント複雑性制御システム](005-document-complexity-control-system.md) - Front-Matter・構造化
- [ADR-006: 統合品質ガードシステム](006-integrated-quality-guard-system.md) - Hook統合・メッセージ出力

### 技術参照
- [AI完璧主義防止計画](../../.claude/tmp/ai_perfectionism_prevention_plan.md) - 改善戦略C,D
- [複雑性制御アーキテクチャ](../../.claude/tmp/complexity_control_architecture.md) - アーキテクチャ背景

### 実装文書（作成予定）
- [CLAUDE.md最適化SOP](../../.claude/docs/03_operations/claude_md_optimization_sop.md)
- [教育的メッセージテンプレート集](../../.claude/docs/02_templates/educational_message_templates.md)
- [AI完璧主義防止詳細ガイド](../../.claude/docs/anti_perfectionism.md)

## Review

### レビュー計画
- **1週間後**: Phase 1-2実装完了・CLAUDE.md最小核化効果測定
- **2週間後**: 教育的メッセージ統一・Claude再試行成功率測定
- **1ヶ月後**: 全体効果確認・開発者体験改善度評価
- **3ヶ月後**: 長期運用状況・次期最適化計画検討

### 成功判定基準
- **最小核化**: CLAUDE.md 150行以下達成・詳細分離完了
- **メッセージ統一**: 全Hook段階での統一テンプレート適用
- **体験改善**: Claude再試行成功率95%達成
- **保守性向上**: ドキュメント・メッセージ更新効率90%改善

---

*このADRは、AI完璧主義防止システム（ADR-003）のドキュメント品質・ユーザー体験最適化を目的とし、CLAUDE.md最小核化・教育的メッセージ統一による開発効率向上を決定するものです。*